{% extends "base.html" %}
{% block content %}
   <h2>Список заявок</h2>

  <!-- Кнопка для открытия фильтров -->
  <button id="openFilters">Открыть фильтры</button>

  <!-- Блок с фильтрами (изначально скрыт) -->
  <div id="filters" style="display: none;">
    <!-- Форма фильтрации -->
    <form method="get" id="filterForm">
      {{ filter_form.as_p }}
      <button type="submit">Применить фильтры</button>
      <button type="button" id="saveFilter">Сохранить фильтр</button>
    </form>

    <!-- Кнопка для закрытия фильтров -->
    <button id="closeFilters">Закрыть фильтры</button>
  </div>

  <!-- Список сохраненных фильтров -->
  <div id="savedFilters">
    <h3>Сохраненные фильтры:</h3>
    <ul>
      {% for saved_filter in saved_filters %}
        <li>
          <a href="?load_filter={{ saved_filter.id }}">{{ saved_filter.filter_name }}</a>
          <a href="?delete_filter={{ saved_filter.id }}" class="deleteFilter">Удалить</a>
        </li>
      {% endfor %}
    </ul>
  </div>


  <div class="requests-list">
    <h3>Список заявок</h3>
    <table>
      <thead>
        <tr>
          <th>Название заявки</th>
          <th>Тип</th>
          <th>Приоритет</th>
            <th>Исполнитель</th>
            <th>Заявитель</th>
          <th>Статус</th>
          <th>Срок выполнения</th>
          <th>Время обновления</th>
        </tr>
      </thead>
      <tbody>
        {% for item in requests_with_action %}
          <tr>
            <td>
              <!-- Ссылка на соответствующую страницу в зависимости от прав доступа -->
              <a href="{% url 'update_request' item.request.pk %}">{{ item.request.title }}</a>
              <td>{{ item.request.request_type }}</td>
    <td>{{ item.request.priority }}</td>
    <td>{{ item.request.status }}</td>
    <td>{% if item.request.due_date %}{{ item.request.due_date|date:"d.m.Y" }}{% else %}Не указано{% endif %}</td>
    <td>{% if item.request.updated_at %}{{ item.request.updated_at|date:"d.m.Y H:i" }}{% else %}Не указано{% endif %}</td>
  </tr>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <p>У вас нет прав на просмотр списка заявок.</p>
{% endblock %}


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const openFiltersButton = document.getElementById('openFilters');
    const closeFiltersButton = document.getElementById('closeFilters');
    const filtersDiv = document.getElementById('filters');

    openFiltersButton.addEventListener('click', function() {
      filtersDiv.style.display = 'block';
    });

    closeFiltersButton.addEventListener('click', function() {
      filtersDiv.style.display = 'none';
    });

    const saveFilterButton = document.getElementById('saveFilter');
    const filterForm = document.getElementById('filterForm');

    saveFilterButton.addEventListener('click', function() {
      const formData = new URLSearchParams(new FormData(filterForm));
      formData.append('saveFilter', 'true');
      window.location.href = '?' + formData.toString();
    });
  });
</script>