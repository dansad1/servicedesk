{{% extends "base.html" %}

{% block content %}
  <h2>Редактирование заявки: {{ request_instance.title }}</h2>

  {% if can_edit %}
    <h3>Редактировать заявку</h3>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Сохранить изменения</button>
    </form>
  {% else %}
    <h3>Информация о заявке</h3>
    <p>Описание: {{ request_instance.description }}</p>
    <p>Статус: {{ request_instance.status }}</p>
  {% endif %}

  {% if can_mark_completed %}
  <h3>Отметить как выполненную</h3>
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="mark_completed" value="true">
    <button type="submit" class="btn btn-success">Отметить как выполненную</button>
  </form>
{% endif %}

  <h3>Комментарии</h3>
  {% if comments %}
    <ul>
      {% for comment in comments %}
        <li>
          {{ comment.author.username }} ({{ comment.created_at|date:"d.m.Y H:i" }}):
          {{ comment.text }}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Комментариев пока нет.</p>
  {% endif %}

  {% if can_edit %}
    <h3>Добавить комментарий</h3>
    <form method="post">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Добавить комментарий</button>
    </form>
  {% endif %}

  <a href="{% url 'request_list' %}">Вернуться к списку заявок</a>
{% endblock %}
