{% extends "base.html" %}

{% block content %}
  <h2>Заявка: {{ request_instance.title }}</h2>
  <p>Описание: {{ request_instance.description }}</p>
  <p>Статус: {{ request_instance.status }}</p>

  <!-- Добавляем отображение срока выполнения (due_date) -->
  <p>Срок выполнения: {{ request_instance.due_date|date:"d.m.Y" }}</p>

  <!-- Добавляем отображение времени обновления (updated_at) -->
  <p>Время обновления: {{ request_instance.updated_at|date:"d.m.Y H:i" }}</p>

  {% if can_edit %}
    <h3>Редактировать заявку</h3>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Сохранить</button>
    </form>
  {% endif %}

  {% if can_mark_completed %}
    <h3>Отметить как выполненную</h3>
    <form method="post">
      {% csrf_token %}
      <input type="checkbox" name="completed" id="id_completed" {% if request_instance.completed %}checked{% endif %}>
      <label for="id_completed">Заявка выполнена</label>
      <button type="submit">Сохранить</button>
    </form>
  {% endif %}

  <h3>Комментарии</h3>
  <ul>
    {% for comment in request_instance.comments.all %}
      <li>{{ comment.text }}</li>
    {% empty %}
      <li>Нет комментариев</li>
    {% endfor %}
  </ul>

  {% if user.is_authenticated %}
    <h3>Добавить комментарий</h3>
    <form method="post">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Добавить комментарий</button>
    </form>
  {% endif %}

  <a href="{% url 'request_list' %}">Вернуться к списку заявок</a>
{% endblock %}
