{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">Редактирование актива: {{ asset.name }}</h2>

    <!-- Форма редактирования актива -->
    <form method="post" class="form-horizontal p-3" style="background-color: #f8f9fa; border-radius: 10px;">
        {% csrf_token %}
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    {{ form.name.label_tag }}
                    {{ form.name }}
                    {% if form.name.errors %}
                    <div class="text-danger">{{ form.name.errors }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    {{ form.asset_type.label_tag }}
                    {{ form.asset_type }}
                    {% if form.asset_type.errors %}
                    <div class="text-danger">{{ form.asset_type.errors }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    {{ form.parent_asset.label_tag }}
                    {{ form.parent_asset }}
                    {% if form.parent_asset.errors %}
                    <div class="text-danger">{{ form.parent_asset.errors }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
        </div>
    </form>

    <!-- Таблица атрибутов для этого актива -->
    <h3 class="mt-5">Атрибуты для актива</h3>

    <table class="table table-striped table-bordered mt-3">
        <thead class="thead-dark">
            <tr>
                <th>Имя атрибута</th>
                <th>Тип атрибута</th>
                <th>Значение</th>
                <th class="text-center">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for asset_attribute in asset.asset_attributes.all %}
            <tr>
                <td>{{ asset_attribute.attribute.name }}</td>
                <td>{{ asset_attribute.attribute.get_attribute_type_display }}</td>
                <td>{{ asset_attribute.get_value_display }}</td> <!-- Функция отображения значения атрибута -->
                <td class="text-center">
                    <!-- Ссылка на редактирование атрибута -->
                    <a href="{% url 'attribute_edit_for_asset' asset_id=asset.id attribute_id=asset_attribute.attribute.id %}" class="btn btn-primary btn-sm">Редактировать</a>

                    <!-- Форма для удаления атрибута -->
                    <form method="post" action="{% url 'attribute_delete_from_asset' asset_id=asset.id attribute_id=asset_attribute.attribute.id %}" class="d-inline-block" onsubmit="return confirm('Вы уверены, что хотите удалить этот атрибут?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Удалить</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center">Атрибуты не найдены.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Кнопки действий -->
    <div class="text-center mt-4">
        <a href="{% url 'attribute_create_for_asset' asset_id=asset.id %}" class="btn btn-success">Добавить новый атрибут</a>
        <a href="{% url 'asset_list' %}" class="btn btn-secondary">Вернуться к списку активов</a>
    </div>
</div>

{% endblock %}
